<!-- manage.component.html -->
<header class="navbar">
  <div class="content">
    <div class="left">
      <a [routerLink]="['/home']" class="logo">
        <img src="../../../assets/logo.jpg" alt="THMG Logo" width="100" height="30">
      </a>
    </div>
    <div class="right">
      <a [routerLink]="['/query']" class="search-icon"><i class="fas fa-search"></i></a>
      <div class="dropdown">
        <span class="username-circle">{{ userInfo?.username?.charAt(0) || '' }}</span>
        <div class="dropdown-content">
          <a (click)="getUserInfo()" [routerLink]="['/user-info']">{{ userInfo?.username }}</a>
          <a (click)="logout()">Logout</a>
          <a *ngIf="is_admin" [routerLink]="['/admin/manage']">Manage</a>
        </div>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="admin-section">
    <h1>Admin Management</h1>

    <div class="admin-functions">
      <!-- 电影管理部分 -->
      <h2>Manage Movies</h2>
      <button (click)="showAddMovieFormToggle()">Add Movie</button>
      <div *ngIf="showAddMovieForm">
        <h3>Add New Movie</h3>
        <form (submit)="addMovie()">
          <label for="title">Title:</label>
          <input type="text" id="title" [(ngModel)]="newMovie.title" name="title" required>
          
          <label for="language">Language:</label>
          <input type="text" id="language" [(ngModel)]="newMovie.language" name="language" required>
          
          <label for="image">Image URL:</label>
          <input type="text" id="image" [(ngModel)]="newMovie.image" name="image">

          <label for="release_date">Release Date:</label>
          <input type="date" id="release_date" [(ngModel)]="newMovie.release_date" name="release_date" required>
          
          <label for="duration">Duration:</label>
          <input type="number" id="duration" [(ngModel)]="newMovie.duration" name="duration" required>

          <label for="tags">Tags:</label>
          <input type="text" id="tags" [(ngModel)]="newMovie.tags" name="tags">
          
          <button type="submit">Save</button>
          <button type="button" (click)="showAddMovieFormToggle()">Cancel</button>
        </form>
      </div>

      <!-- 用户管理部分 -->
      <h2>Manage Users</h2>
      <button (click)="getAllUsers()">Get All Users</button>
    </div>

    <!-- 显示所有用户信息 -->
    <div *ngIf="users.length > 0">
      <h3>All Users</h3>
      <div *ngFor="let user of users" class="user-item">
        <p>{{ user.username }}</p>
        <button (click)="toggleAdmin(user._id)">Toggle Admin</button>
      </div>
    </div>

    <!-- 显示所有电影信息 -->
    <div *ngIf="movies.length > 0">
      <h3>All Movies</h3>
      <div *ngFor="let movie of movies" class="movie-item">
        <p>{{ movie.title }}</p>
        <button (click)="showEditMovieFormToggle(movie)">Edit</button>
        <button (click)="deleteMovie(movie._id)">Delete</button>
      </div>
    </div>

    <!-- 编辑电影表单 -->
    <div *ngIf="showEditMovieForm">
      <h3>Edit Movie</h3>
      <form (submit)="editMovie(selectedMovie._id)">
        <label for="edit-title">Title:</label>
        <input type="text" id="edit-title" [(ngModel)]="selectedMovie.title" name="edit-title" required>
        
        <label for="edit-language">Language:</label>
        <input type="text" id="edit-language" [(ngModel)]="selectedMovie.language" name="edit-language" required>
        
        <label for="edit-image">Image URL:</label>
        <input type="text" id="edit-image" [(ngModel)]="selectedMovie.image" name="edit-image">

        <label for="edit-release_date">Release Date:</label>
        <input type="date" id="edit-release_date" [(ngModel)]="selectedMovie.release_date" name="edit-release_date" required>
        
        <label for="edit-duration">Duration:</label>
        <input type="number" id="edit-duration" [(ngModel)]="selectedMovie.duration" name="edit-duration" required>

        <label for="edit-tags">Tags:</label>
        <input type="text" id="edit-tags" [(ngModel)]="selectedMovie.tags" name="edit-tags">
        
        <button type="submit">Save</button>
        <button type="button" (click)="showEditMovieFormToggle(selectedMovie)">Cancel</button>
      </form>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="content">
    <div class="left">
      <img src="../../../assets/logo.jpg" alt="THMG Logo" width="100" height="auto">
    </div>
    <div class="right">
      <span class="greeting">Hello, {{ userInfo?.username }}!</span>
    </div>
  </div>
</footer>
